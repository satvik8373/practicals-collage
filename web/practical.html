<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Practical</title>
	<link rel="stylesheet" href="../assets/style.css">
</head>
<body>
<header class="topbar">
	<div class="container"><div class="brand"><a href="./index.html">P21A2WDT Practicals</a></div></div>
</header>
<main class="container">
	<a href="./index.html">&larr; Back</a>
	<h2 id="title"></h2>
	<div class="viewer">
		<div class="panel">
			<div class="panel-header">Code</div>
			<div class="panel-body">
				<textarea id="code" class="code" spellcheck="false"></textarea>
				<div class="controls">
					<button id="run">Run</button>
					<button class="secondary" id="reset">Reset</button>
				</div>
			</div>
		</div>
		<div class="panel">
			<div class="panel-header">Output</div>
			<div class="panel-body">
				<pre id="output" class="output"></pre>
			</div>
		</div>
	</div>
</main>
<footer class="footer"><div class="container"><p>&copy; <span id="y"></span> CS Dept</p></div></footer>
<script>
const PRACTICALS = [
	'Check if a number is palindrome',
	'Display messages using if/elseif/switch',
	'User-defined functions for arithmetic',
	'Registration to confirmation and report pages',
	'String functions demonstration',
	'Arrays and array functions',
	'OOP: Person and Teacher (inheritance)',
	'OOP: Shape, Rectangle, Circle with area()',
	'Abstract class usage and implementation',
	'File upload to directory',
	'Login with sessions',
	'Order form with hidden product ID',
	'PDO MySQL connect success message',
	'Insert form using PDO prepared statements',
	'Update/Delete employee using PDO',
	'CRUD app with dynamic CSS records',
	'Read XML using simplexml_load_file()',
	'Create XML using SimpleXML',
	'Associative array to JSON using json_encode()',
	'Send email and SMS (Fast2SMS API)',
	'Integrate payment (PayPal/Razorpay) — steps',
	'Server-side validation in PHP',
	'SQL Injection demo',
	'XSS script injection demo',
	'Deploy PHP/MySQL app from XAMPP to live',
	'Export MySQL database to .sql — steps'
];
const params = new URLSearchParams(location.search);
const id = parseInt(params.get('id') || '1', 10);
document.getElementById('title').textContent = `#${id} — ${PRACTICALS[id-1] || 'Practical'}`;
document.getElementById('y').textContent = new Date().getFullYear();

const codeEl = document.getElementById('code');
const outputEl = document.getElementById('output');
const runBtn = document.getElementById('run');
const resetBtn = document.getElementById('reset');

let originalCode = '';
fetch(`../samples/p${id}.php`).then(r=>r.text()).then(t=>{ originalCode=t; codeEl.value=t; });

runBtn.addEventListener('click', async () => {
	outputEl.textContent = 'Running...';
	try {
		const apiBase = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') && location.port === '5500'
			? 'http://localhost:3000/api'
			: '/api';
		const res = await fetch(`${apiBase}/run`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ language: 'php', files: [{name:`p${id}.php`, content: codeEl.value}] }) });
		let data;
		try { data = await res.json(); } catch { data = { error: 'Non-JSON response', status: res.status }; }
		if (!res.ok) {
			outputEl.textContent = 'Error: ' + (data?.error || res.statusText);
			return;
		}
		outputEl.textContent = (data.run?.stdout || '') + (data.run?.stderr || '') || (data?.message || '');
	} catch (e) {
		outputEl.textContent = 'Error: ' + e;
	}
});

resetBtn.addEventListener('click', () => { codeEl.value = originalCode; outputEl.textContent=''; });
</script>
</body>
</html>


